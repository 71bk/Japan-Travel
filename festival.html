<!DOCTYPE html>
<html lang="zh-Hant" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>慶典詳細｜通用模板（含深/淺色主題切換）</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --fg: #0f172a;
      --muted: #475569;
      --brand: #2563eb;
      --card: #ffffff;
      --border: #e2e8f0;
      --radius: 14px;
      --shadow: 0 4px 12px rgba(0, 0, 0, .12);
      --hero-overlay-from: rgba(255, 255, 255, 0);
      --hero-overlay-to: rgba(255, 255, 255, .70);
      --hero-img-brightness: 1.08;
    }

    [data-theme="dark"] {
      --bg: #0b132b;
      --fg: #f8fafc;
      --muted: #94a3b8;
      --brand: #60a5fa;
      --card: #0f172a;
      --border: #1f2937;
      --shadow: 0 10px 30px rgba(0, 0, 0, .28);
      --hero-overlay-from: rgba(0, 0, 0, 0);
      --hero-overlay-to: rgba(0, 0, 0, .65);
      --hero-img-brightness: 1.0;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial
    }

    a {
      color: var(--brand);
      text-decoration: none
    }

    a:hover {
      text-decoration: underline
    }

    .container {
      max-width: 1080px;
      margin-inline: auto;
      padding: 24px;
      position: relative
    }

    .theme-toggle {
      position: fixed;
      right: 24px;
      top: 16px;
      z-index: 1000;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--fg);
      padding: 8px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      cursor: pointer
    }

    .theme-toggle:hover {
      filter: brightness(.98)
    }

    .hero {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      background: #e2e8f0;
      box-shadow: var(--shadow)
    }

    .hero-img {
      width: 100%;
      display: block;
      aspect-ratio: 16/9;
      object-fit: cover;
      opacity: .98;
      filter: brightness(var(--hero-img-brightness))
    }

    .hero-content {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: flex-end;
      background: linear-gradient(180deg, var(--hero-overlay-from) 40%, var(--hero-overlay-to) 100%)
    }

    .hero-text {
      padding: 28px
    }

    .title {
      margin: 0 0 6px;
      font-size: clamp(24px, 3.2vw, 40px);
      letter-spacing: .02em
    }

    .subtitle {
      margin: 0;
      color: var(--muted)
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 28px;
      margin-top: 28px
    }

    @media (max-width:900px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow)
    }

    .card>* {
      padding: 20px
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: clamp(18px, 2.4vw, 24px)
    }

    .card p {
      margin: 0 0 10px;
      line-height: 1.75
    }

    .card ul {
      margin: 0;
      padding-left: 20px
    }

    .aside {
      position: sticky;
      top: 16px;
      height: fit-content
    }

    .toc a {
      display: block;
      padding: 10px 14px;
      border-bottom: 1px dashed var(--border);
      color: inherit
    }

    .toc a:hover {
      background: rgba(0, 0, 0, .04)
    }

    .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      background: rgba(0, 0, 0, .04);
      color: inherit;
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px
    }

    [data-theme="dark"] .pill {
      background: rgba(255, 255, 255, .06)
    }

    .back {
      display: inline-block;
      margin-top: 18px;
      background: var(--brand);
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px
    }

    .back:hover {
      filter: brightness(.95)
    }
  </style>
</head>

<body>
  <div class="container">
    <button class="theme-toggle" id="themeToggle" aria-pressed="false" title="切換主題">🌙 深色</button>

    <section class="hero" id="top">
      <img class="hero-img" id="heroImg" alt="festival hero" />
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="title" id="fesTitle">慶典名稱</h1>
          <p class="subtitle" id="fesSubtitle">地區／一句話亮點</p>
          <div class="meta" aria-label="meta">
            <span class="pill" id="metaMonth">月份：—</span>
            <span class="pill" id="metaVenue">場地：—</span>
          </div>
        </div>
      </div>
    </section>

    <div class="grid">
      <main class="content">
        <article class="card" id="intro">
          <div>
            <h2>活動介紹</h2>
            <p id="introText">以 URL 參數或 data.js 自動帶入；若無，這裡會顯示示範文字。</p>
          </div>
        </article>

        <article class="card" id="schedule">
          <div>
            <h2>時間表</h2>
            <p id="scheduleText">日期／每日流程（選填）。</p>
          </div>
        </article>

        <article class="card" id="tips">
          <div>
            <h2>看點 / 建議</h2>
            <ul id="tipsList">
              <li>建議提前訂房與交通</li>
            </ul>
          </div>
        </article>

        <article class="card" id="info">
          <div>
            <h2>場地與交通</h2>
            <p id="venueText">場地：—</p>
            <p id="accessText">交通：—</p>
            <p id="siteText">官網：—</p>
            <a id="backLink" class="back" href="#">← 返回地區</a>
          </div>
        </article>
        

      </main>

      <aside class="aside">
        <nav class="card toc" aria-label="頁內導覽">
          <div>
            <h2 style="padding:20px 20px 10px;margin:0">快速導覽</h2>
            <a href="#intro">活動介紹</a>
            <a href="#schedule">時間表</a>
            <a href="#tips">看點 / 建議</a>
            <a href="#info">場地與交通</a>
            <a href="#top">回到最上方 ↑</a>
          </div>
        </nav>
      </aside>
    </div>
  </div>

  <script type="module">
    const qp = new URLSearchParams(location.search);
    const region = qp.get('region') || '';
    const category = qp.get('category') || '慶典';
    const name = qp.get('name') || qp.get('spot') || '';
    const imgParam = qp.get('img');
    const subtitle = qp.get('subtitle');

    // URL 後備欄位
    const introParam = qp.get('intro');
    const scheduleParam = qp.get('schedule');
    const venueParam = qp.get('venue');
    const accessParam = qp.get('access');
    const websiteParam = qp.get('website');
    const tipsParam = qp.get('tips');

   const guessImg = region && name ? `./image/pic/${region}/${name}.jpg` : '';
    const $ = (id) => document.getElementById(id);

    $('fesTitle').textContent = name || '慶典名稱';
    $('fesSubtitle').textContent = subtitle || (region ? `${region}｜年度盛事` : '地區／一句話亮點');
    $('heroImg').src = imgParam || guessImg || 'data:image/svg+xml,%3Csvg xmlns%3D"http://www.w3.org/2000/svg" viewBox%3D"0 0 1600 900"%3E%3Crect width%3D"1600" height%3D"900" fill%3D"%23e2e8f0"/%3E%3C/svg%3E';

    if (introParam) $('introText').textContent = introParam;
    if (scheduleParam) $('scheduleText').textContent = scheduleParam;
    if (venueParam) $('venueText').textContent = `場地：${venueParam}`;
    if (accessParam) $('accessText').textContent = accessParam;
    if (websiteParam) $('siteText').innerHTML = `官網：<a href="${websiteParam}" target="_blank" rel="noopener">${websiteParam}</a>`;
    if (tipsParam) $('tipsList').innerHTML = tipsParam.split(';').map(s => `<li>${s.trim()}</li>`).join('');

    // 嘗試載入 data.js（掃所有月份）
    const DATA_CANDIDATES = ['../js/data.js', '../../js/data.js', './js/data.js', '../data.js'];
    for (const p of DATA_CANDIDATES) {
      try {
        const mod = await import(p);
        const dataset = mod.data || mod.default; if (!dataset) continue;
        const r = dataset[region]; if (!r) break;

        const fes = r.慶典 || {};
        let found = null, month = null;
        for (const m of Object.keys(fes).sort((a, b) => +a - +b)) {
          const arr = Array.isArray(fes[m]) ? fes[m] : [];
          const hit = arr.find(v => (v.名稱 || v.name) === name);
          if (hit) { found = hit; month = m; break; }
        }
        if (!found) break;

        const d = found.詳細 || {};
        if (found.名稱) $('fesTitle').textContent = found.名稱;
        $('fesSubtitle').textContent = d.副標 || found.說明 || $('fesSubtitle').textContent;
        $('introText').textContent = d.介紹 || found.說明 || $('introText').textContent;

        if (month) $('metaMonth').textContent = `月份：${month}`;
        if (d.場地) $('metaVenue').textContent = `場地：${d.場地}`;
        if (d.時間表) $('scheduleText').textContent = d.時間表;
        if (d.場地) $('venueText').textContent = `場地：${d.場地}`;
        if (d.交通) $('accessText').textContent = d.交通;
        if (d.官網) $('siteText').innerHTML = `官網：<a href="${d.官網}" target="_blank" rel="noopener">${d.官網}</a>`;
        if (d.推薦 || d.看點) $('tipsList').innerHTML = (Array.isArray(d.推薦 || d.看點) ? (d.推薦 || d.看點) : String(d.推薦 || d.看點).split(';')).map(s => `<li>${s.trim()}</li>`).join('');

        const img = d.圖片 || guessImg; if (img) $('heroImg').src = img;
        break;
      } catch (e) { /* 繼續嘗試下一個路徑 */ }
    }

    // 主題切換：同 detail.html
    const key = 'spot-theme';
    const prefersDark = matchMedia && matchMedia('(prefers-color-scheme: dark)').matches;
    const saved = localStorage.getItem(key);
    const initial = saved || (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', initial);
    const btn = $('themeToggle');
    const setLabel = (m) => { btn.textContent = m === 'dark' ? '☀️ 淺色' : '🌙 深色'; btn.setAttribute('aria-pressed', String(m === 'dark')); };
    setLabel(initial);
    btn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem(key, next);
      setLabel(next);
    });

    // 返回帶地區錨點
    
    const back = document.getElementById('backLink');
    if (back) {
      const url = new URL('index.html', location.href); // 同層
      if (typeof region === 'string' && region) {
        url.hash = encodeURIComponent(region);
      }
      back.href = url.href;
      back.addEventListener('click', (e) => {
        e.preventDefault();
        location.assign(url.href); // 保險跳轉
      });
    }
  </script>
</body>

</html>