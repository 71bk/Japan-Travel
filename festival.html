<!DOCTYPE html>
<html lang="zh-Hant" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ…¶å…¸è©³ç´°ï½œé€šç”¨æ¨¡æ¿ï¼ˆå«æ·±/æ·ºè‰²ä¸»é¡Œåˆ‡æ›ï¼‰</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --fg: #0f172a;
      --muted: #475569;
      --brand: #2563eb;
      --card: #ffffff;
      --border: #e2e8f0;
      --radius: 14px;
      --shadow: 0 4px 12px rgba(0, 0, 0, .12);
      --hero-overlay-from: rgba(255, 255, 255, 0);
      --hero-overlay-to: rgba(255, 255, 255, .70);
      --hero-img-brightness: 1.08;
    }

    [data-theme="dark"] {
      --bg: #0b132b;
      --fg: #f8fafc;
      --muted: #94a3b8;
      --brand: #60a5fa;
      --card: #0f172a;
      --border: #1f2937;
      --shadow: 0 10px 30px rgba(0, 0, 0, .28);
      --hero-overlay-from: rgba(0, 0, 0, 0);
      --hero-overlay-to: rgba(0, 0, 0, .65);
      --hero-img-brightness: 1.0;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial
    }

    a {
      color: var(--brand);
      text-decoration: none
    }

    a:hover {
      text-decoration: underline
    }

    .container {
      max-width: 1080px;
      margin-inline: auto;
      padding: 24px;
      position: relative
    }

    .theme-toggle {
      position: fixed;
      right: 24px;
      top: 16px;
      z-index: 1000;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--fg);
      padding: 8px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      cursor: pointer
    }

    .theme-toggle:hover {
      filter: brightness(.98)
    }

    .hero {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      background: #e2e8f0;
      box-shadow: var(--shadow)
    }

    .hero-img {
      width: 100%;
      display: block;
      aspect-ratio: 16/9;
      object-fit: cover;
      opacity: .98;
      filter: brightness(var(--hero-img-brightness))
    }

    .hero-content {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: flex-end;
      background: linear-gradient(180deg, var(--hero-overlay-from) 40%, var(--hero-overlay-to) 100%)
    }

    .hero-text {
      padding: 28px
    }

    .title {
      margin: 0 0 6px;
      font-size: clamp(24px, 3.2vw, 40px);
      letter-spacing: .02em
    }

    .subtitle {
      margin: 0;
      color: var(--muted)
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 28px;
      margin-top: 28px
    }

    @media (max-width:900px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow)
    }

    .card>* {
      padding: 20px
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: clamp(18px, 2.4vw, 24px)
    }

    .card p {
      margin: 0 0 10px;
      line-height: 1.75
    }

    .card ul {
      margin: 0;
      padding-left: 20px
    }

    .aside {
      position: sticky;
      top: 16px;
      height: fit-content
    }

    .toc a {
      display: block;
      padding: 10px 14px;
      border-bottom: 1px dashed var(--border);
      color: inherit
    }

    .toc a:hover {
      background: rgba(0, 0, 0, .04)
    }

    .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      background: rgba(0, 0, 0, .04);
      color: inherit;
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px
    }

    [data-theme="dark"] .pill {
      background: rgba(255, 255, 255, .06)
    }

    .back {
      display: inline-block;
      margin-top: 18px;
      background: var(--brand);
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px
    }

    .back:hover {
      filter: brightness(.95)
    }
  </style>
</head>

<body>
  <div class="container">
    <button class="theme-toggle" id="themeToggle" aria-pressed="false" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ™ æ·±è‰²</button>

    <section class="hero" id="top">
      <img class="hero-img" id="heroImg" alt="festival hero" />
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="title" id="fesTitle">æ…¶å…¸åç¨±</h1>
          <p class="subtitle" id="fesSubtitle">åœ°å€ï¼ä¸€å¥è©±äº®é»</p>
          <div class="meta" aria-label="meta">
            <span class="pill" id="metaMonth">æœˆä»½ï¼šâ€”</span>
            <span class="pill" id="metaVenue">å ´åœ°ï¼šâ€”</span>
          </div>
        </div>
      </div>
    </section>

    <div class="grid">
      <main class="content">
        <article class="card" id="intro">
          <div>
            <h2>æ´»å‹•ä»‹ç´¹</h2>
            <p id="introText">ä»¥ URL åƒæ•¸æˆ– data.js è‡ªå‹•å¸¶å…¥ï¼›è‹¥ç„¡ï¼Œé€™è£¡æœƒé¡¯ç¤ºç¤ºç¯„æ–‡å­—ã€‚</p>
          </div>
        </article>

        <article class="card" id="schedule">
          <div>
            <h2>æ™‚é–“è¡¨</h2>
            <p id="scheduleText">æ—¥æœŸï¼æ¯æ—¥æµç¨‹ï¼ˆé¸å¡«ï¼‰ã€‚</p>
          </div>
        </article>

        <article class="card" id="tips">
          <div>
            <h2>çœ‹é» / å»ºè­°</h2>
            <ul id="tipsList">
              <li>å»ºè­°æå‰è¨‚æˆ¿èˆ‡äº¤é€š</li>
            </ul>
          </div>
        </article>

        <article class="card" id="info">
          <div>
            <h2>å ´åœ°èˆ‡äº¤é€š</h2>
            <p id="venueText">å ´åœ°ï¼šâ€”</p>
            <p id="accessText">äº¤é€šï¼šâ€”</p>
            <p id="siteText">å®˜ç¶²ï¼šâ€”</p>
            <a id="backLink" class="back" href="#">â† è¿”å›åœ°å€</a>
          </div>
        </article>
        

      </main>

      <aside class="aside">
        <nav class="card toc" aria-label="é å…§å°è¦½">
          <div>
            <h2 style="padding:20px 20px 10px;margin:0">å¿«é€Ÿå°è¦½</h2>
            <a href="#intro">æ´»å‹•ä»‹ç´¹</a>
            <a href="#schedule">æ™‚é–“è¡¨</a>
            <a href="#tips">çœ‹é» / å»ºè­°</a>
            <a href="#info">å ´åœ°èˆ‡äº¤é€š</a>
            <a href="#top">å›åˆ°æœ€ä¸Šæ–¹ â†‘</a>
          </div>
        </nav>
      </aside>
    </div>
  </div>

  <script type="module">
    const qp = new URLSearchParams(location.search);
    const region = qp.get('region') || '';
    const category = qp.get('category') || 'æ…¶å…¸';
    const name = qp.get('name') || qp.get('spot') || '';
    const imgParam = qp.get('img');
    const subtitle = qp.get('subtitle');

    // URL å¾Œå‚™æ¬„ä½
    const introParam = qp.get('intro');
    const scheduleParam = qp.get('schedule');
    const venueParam = qp.get('venue');
    const accessParam = qp.get('access');
    const websiteParam = qp.get('website');
    const tipsParam = qp.get('tips');

   const guessImg = region && name ? `./image/pic/${region}/${name}.jpg` : '';
    const $ = (id) => document.getElementById(id);

    $('fesTitle').textContent = name || 'æ…¶å…¸åç¨±';
    $('fesSubtitle').textContent = subtitle || (region ? `${region}ï½œå¹´åº¦ç››äº‹` : 'åœ°å€ï¼ä¸€å¥è©±äº®é»');
    $('heroImg').src = imgParam || guessImg || 'data:image/svg+xml,%3Csvg xmlns%3D"http://www.w3.org/2000/svg" viewBox%3D"0 0 1600 900"%3E%3Crect width%3D"1600" height%3D"900" fill%3D"%23e2e8f0"/%3E%3C/svg%3E';

    if (introParam) $('introText').textContent = introParam;
    if (scheduleParam) $('scheduleText').textContent = scheduleParam;
    if (venueParam) $('venueText').textContent = `å ´åœ°ï¼š${venueParam}`;
    if (accessParam) $('accessText').textContent = accessParam;
    if (websiteParam) $('siteText').innerHTML = `å®˜ç¶²ï¼š<a href="${websiteParam}" target="_blank" rel="noopener">${websiteParam}</a>`;
    if (tipsParam) $('tipsList').innerHTML = tipsParam.split(';').map(s => `<li>${s.trim()}</li>`).join('');

    // å˜—è©¦è¼‰å…¥ data.jsï¼ˆæƒæ‰€æœ‰æœˆä»½ï¼‰
    const DATA_CANDIDATES = ['../js/data.js', '../../js/data.js', './js/data.js', '../data.js'];
    for (const p of DATA_CANDIDATES) {
      try {
        const mod = await import(p);
        const dataset = mod.data || mod.default; if (!dataset) continue;
        const r = dataset[region]; if (!r) break;

        const fes = r.æ…¶å…¸ || {};
        let found = null, month = null;
        for (const m of Object.keys(fes).sort((a, b) => +a - +b)) {
          const arr = Array.isArray(fes[m]) ? fes[m] : [];
          const hit = arr.find(v => (v.åç¨± || v.name) === name);
          if (hit) { found = hit; month = m; break; }
        }
        if (!found) break;

        const d = found.è©³ç´° || {};
        if (found.åç¨±) $('fesTitle').textContent = found.åç¨±;
        $('fesSubtitle').textContent = d.å‰¯æ¨™ || found.èªªæ˜ || $('fesSubtitle').textContent;
        $('introText').textContent = d.ä»‹ç´¹ || found.èªªæ˜ || $('introText').textContent;

        if (month) $('metaMonth').textContent = `æœˆä»½ï¼š${month}`;
        if (d.å ´åœ°) $('metaVenue').textContent = `å ´åœ°ï¼š${d.å ´åœ°}`;
        if (d.æ™‚é–“è¡¨) $('scheduleText').textContent = d.æ™‚é–“è¡¨;
        if (d.å ´åœ°) $('venueText').textContent = `å ´åœ°ï¼š${d.å ´åœ°}`;
        if (d.äº¤é€š) $('accessText').textContent = d.äº¤é€š;
        if (d.å®˜ç¶²) $('siteText').innerHTML = `å®˜ç¶²ï¼š<a href="${d.å®˜ç¶²}" target="_blank" rel="noopener">${d.å®˜ç¶²}</a>`;
        if (d.æ¨è–¦ || d.çœ‹é») $('tipsList').innerHTML = (Array.isArray(d.æ¨è–¦ || d.çœ‹é») ? (d.æ¨è–¦ || d.çœ‹é») : String(d.æ¨è–¦ || d.çœ‹é»).split(';')).map(s => `<li>${s.trim()}</li>`).join('');

        const img = d.åœ–ç‰‡ || guessImg; if (img) $('heroImg').src = img;
        break;
      } catch (e) { /* ç¹¼çºŒå˜—è©¦ä¸‹ä¸€å€‹è·¯å¾‘ */ }
    }

    // ä¸»é¡Œåˆ‡æ›ï¼šåŒ detail.html
    const key = 'spot-theme';
    const prefersDark = matchMedia && matchMedia('(prefers-color-scheme: dark)').matches;
    const saved = localStorage.getItem(key);
    const initial = saved || (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', initial);
    const btn = $('themeToggle');
    const setLabel = (m) => { btn.textContent = m === 'dark' ? 'â˜€ï¸ æ·ºè‰²' : 'ğŸŒ™ æ·±è‰²'; btn.setAttribute('aria-pressed', String(m === 'dark')); };
    setLabel(initial);
    btn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem(key, next);
      setLabel(next);
    });

    // è¿”å›å¸¶åœ°å€éŒ¨é»
    
    const back = document.getElementById('backLink');
    if (back) {
      const url = new URL('index.html', location.href); // åŒå±¤
      if (typeof region === 'string' && region) {
        url.hash = encodeURIComponent(region);
      }
      back.href = url.href;
      back.addEventListener('click', (e) => {
        e.preventDefault();
        location.assign(url.href); // ä¿éšªè·³è½‰
      });
    }
  </script>
</body>

</html>